---
title: （进行中）在微服务中 SAGA 和 CQRS 设计模式的差异？
date: 2023-08-27 15:57:22
cover: https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/cover/SAGA_vs_CQRS.png

# author information, multiple authors are set to array
# single author
author:
- nick: Soma
  link: https://medium.com/@somasharma_81597
- nick: 董宗磊
  link: https://www.github.com/dongzl

# post subtitle in your index page
subtitle: 一个大家不能错过的微服务热门面试题。

categories:
- 架构设计

tags:
- 微服务
- SAGA
- CQRS
---

> 原文链接：https://medium.com/javarevisited/difference-between-saga-and-cqrs-design-patterns-in-microservices-acd1729a6b02

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/23.Difference-Between-SAGA-CQRS-Design-Patterns-Microservices/01.webp"/>

大家好，如果您听说过微服务世界中的 SAGA 模式和 CQRS 模式，并且想知道它们是什么以及何时使用它们，那么您来对地方了。SAGA 和 CQRS 模式之间的区别是Java 面试中常见的问题之一。

SAGA 模式和 CQRS 都是微服务架构中使用的流行模式，但它们有不同的用途。

SAGA 和 CQRS 之间的主要区别在于，SAGA 侧重于系统的事务一致性，而 CQRS 侧重于系统的可扩展性和性能 ，但您将在本文中找到更多有关它们的信息。

过去，我在为初学者和经验丰富的开发人员分享50 个微服务面试问题和10 个基本的微服务设计原则时提到过SAGA 模式，在这篇文章中，我将分享两者之间的区别以及何时使用 SAGA 和微服务中的 CQRS 模式。

<hr />

## 微服务架构中的SAGA模式是什么？

SAGA 模式用于管理跨多个服务的事务。它确保事务中涉及的每个服务提交或回滚其事务部分，即使其他服务失败也是如此。

例如，在电子商务应用程序中，当用户发起在线购买时，这涉及支付处理、订单管理和运输等多种服务。

> SAGA 模式可用于确保如果这些服务中的任何一个失败，事务都会回滚，并且用户的钱会被退还。

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/23.Difference-Between-SAGA-CQRS-Design-Patterns-Microservices/02.webp"/>

<hr />

## 微服务中的 CQRS 模式是什么？它解决什么问题？

CQRS （命令查询职责分离）模式用于将应用程序的读写操作分离到不同的模型中。它允许不同的模型针对各自的任务进行优化。

例如，考虑一个银行应用程序，用户可以在其中查看帐户余额、交易历史记录并进行转账。读取操作（例如查看帐户余额）可以针对高可用性和低延迟进行优化，而写入操作（例如进行传输）可以针对数据一致性和准确性进行优化。

> 通过分离读写操作，我们可以为每个操作选择合适的存储和处理机制。

以下是微服务架构中 CQRS 模式的样子：

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/23.Difference-Between-SAGA-CQRS-Design-Patterns-Microservices/03.webp"/>

综上所述，SAGA和CQRS是微服务架构中使用的两种不同的设计模式。

SAGA用于管理跨多个服务的事务，而CQRS用于将应用程序的读写操作分离到不同的模型中。

<hr />

## 微服务架构中SAGA和CQRS设计模式的区别？

现在您已经了解了 SAGA 和 CQRS 模式之间的基本区别，让我们看看它们之间的更多区别。当然，下面是微服务中 SAGA 和 CQRS 模式之间的表格比较：

### 1. 他们解决什么问题？

SAGA 是一种用于管理分布式事务序列的模式，其中每个事务更新多个服务中的数据，而 CQRS 是一种分离系统中的读取和写入操作的模式，每个操作使用单独的模型。

### 2. 功能

SAGA用于在业务事务需要更新多个服务时确保跨多个微服务的数据一致性，而CQRS模式用于通过分离读写操作并分别优化来提高系统的可扩展性、性能和可用性。

### 3. 工作

SAGA 使用一系列补偿事务来协调事务，如果发生错误，这些补偿事务将回滚前一个事务所做的更改。另一方面，CQRS 使用不同的模型进行读写操作。写入模型针对数据修改进行了优化，而读取模型针对查询和数据检索进行了优化。

### 4. 一致性与可扩展性
   
SAGA 是一种在分布式系统中维护数据一致性的解决方案，其中数据分布在多个服务中。另一方面，CQRS 是一种通过分离读写操作并为每个操作使用不同模型来扩展系统的解决方案。

### 5. 复杂性
   
SAGA 模式的实现和管理可能很复杂，因为它涉及协调跨多个服务的多个事务，而 CQRS 可以通过分离读写操作并为每个操作使用优化模型来简化复杂系统的管理。

### 6.什么时候使用？

SAGA 模式最适合需要更新多个微服务作为单个业务事务的一部分的场景。而CQRS最适合读写操作大量使用且需要单独优化的场景。

SAGA模式通常用于需要强事务一致性的系统，例如金融系统，而CQRS模式则用于需要高可扩展性和性能的系统，例如社交媒体平台。

### 7. 实施

SAGA 模式可以使用编排或编排方法来实现，而 CQRS 模式通常使用事件源来实现。

这就是微服务架构中SAGA模式和CQRS设计模式的区别。SAGA和CQRS之间的主要区别在于SAGA侧重于系统的事务一致性，而CQRS侧重于系统的可扩展性和性能

同样重要的是要注意，这两种模式可以在微服务架构中一起使用以实现不同的目标。

事实上，SAGA 和 CQRS 模式都可以在微服务架构中一起使用，以实现强大的事务一致性以及高可扩展性和性能。但是，这可能会增加系统的额外复杂性，因此请确保在使用 SAGA 或 CQRS 模式之前分析情况和优缺点。

顺便说一句，这些只是众多可用的微服务设计模式中的两个，您可以自己学习，我将来还将分享更多模式。
