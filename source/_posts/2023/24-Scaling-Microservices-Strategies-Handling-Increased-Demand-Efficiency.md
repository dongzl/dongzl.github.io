---
title: （进行中）扩展微服务：以 99% 的效率处理不断增长的需求的策略
date: 2013-03-24 20:03:22
cover: https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/cover/scaling_microservices.png

# author information, multiple authors are set to array
# single author
author:
- nick: Soma
  link: https://medium.com/@somasharma_81597
- nick: 董宗磊
  link: https://www.github.com/dongzl

# post subtitle in your index page
subtitle: 打造弹性微服务基础设施：在处理激增的需求方面实现 99% 效率的行之有效的策略。

categories:
- 架构设计

tags:
- 微服务
- 弹性
---

> 原文链接：https://blog.stackademic.com/scaling-microservices-strategies-for-handling-increased-demand-with-99-efficiency-1ce47dd02490

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/04.webp"/>

大家好，很多人要求我写一篇关于如何在现实世界中扩展微服务的文章？这让我对这篇文章有了一个想法，我将在其中分享我对扩展微服务的了解，并为您提供一个将微服务扩展至数百万的示例，同时保持 99% 的正常运行时间，而这正是 Uber.com（我最喜欢的出租车叫车服务）应用程序。

创建一个正在工作的微服务是一回事，而创建一个每天与数百万用户发送数十亿事件毫无意义地工作的微服务则完全不同。

近年来，微服务架构因其创建模块化、独立且高度可扩展的软件系统的能力而受到广泛欢迎。然而，随着应用程序用户群的增长和流量的增加，有效扩展微服务成为一项关键挑战。

在过去的几篇文章中，我一直在分享我在微服务和 Spring Cloud 方面的经验，例如微服务最佳实践、微服务设计模式、50 个微服务面试问题和微服务的 10 个 Spring Cloud 功能，我之前也分享过关于SAGA 设计模式和单体的文章与微服务架构。

在本文中，我们将深入研究处理基于微服务的应用程序中增加的流量和需求的策略，重点关注负载平衡、自动扩展和性能优化。我们还将探索一个现实世界的例子来说明这些概念的实际应用。

顺便说一句，如果您是微服务架构的新手，那么您最好首先浏览这些微服务在线课程、书籍、免费教程和项目，以了解微服务架构的基础知识以及如何在 Java 或其他编程中实现它们语言。

<hr />

### 1. 扩展微服务的挑战

微服务架构将单一应用程序分解为更小的、互连的服务，这些服务通过网络相互通信。

这种设计允许灵活性、更好的资源利用率以及服务的独立开发和部署。然而，随着用户流量的增长，个别服务可能会遇到瓶颈和性能问题。

扩展微服务提出了组织需要解决的几个挑战，以确保其系统能够有效地处理增加的流量和需求。一些主要挑战包括：

1. 服务依赖性：微服务通常依赖其他服务来执行特定功能。随着流量的增加，服务之间的相互依赖性可能会导致瓶颈和性能问题，从而影响整个系统的可扩展性。
2. 数据管理：跨分布式微服务协调和管理数据可能会变得复杂，尤其是在处理大型数据集时。确保跨服务的数据一致性、可用性和完整性可能是一个挑战。
3. 网络通信开销：微服务通过网络进行通信，随着服务数量的增长，网络通信可能会成为一项巨大的开销。这可能会导致延迟并缩短响应时间，从而影响用户体验。
4. 操作复杂性：操作和监控大量微服务需要强大的基础设施、部署管道和监控工具。随着系统的扩展，管理这些方面变得越来越复杂。
5. 动态可扩展性：虽然自动扩展是一项关键策略，但根据需求动态添加或删除实例可能会导致资源争用，尤其是在实施不当的情况下。
6. 一致性和事务：维护分布式服务之间的事务一致性可能具有挑战性。确保多个服务的更新完全完成或在发生故障时完全回滚是很复杂的。
7. 状态管理：管理微服务的状态，尤其是在需要状态的场景中，可能很困难。处理有状态服务的故障转移和复制增加了扩展过程的复杂性。
8. 安全和授权：在处理增加的流量的同时确保微服务的安全性需要强大的身份验证和授权机制。随着请求数量的增加，管理安全性变得更加重要。

应对这些挑战需要仔细规划、架构考虑以及在微服务开发、部署和运营方面采用最佳实践。成功的扩展需要技术专业知识、监控工具和持续优化工作的结合。

但是，不用担心，我们将看到您可以遵循的最佳实践，将您的微服务扩展到数百万用户，并保持 99% 的效率。

<hr />

### 2. 了解负载均衡

负载平衡是在服务的多个实例之间分配传入网络流量的关键策略，以确保资源利用率均匀并防止任何单个实例过载。

有多种负载平衡算法，每种算法都有其优点和用例：

1. 循环：请求以循环顺序均匀分布在实例之间。
2. 最少连接：流量路由到活动连接最少的服务器。
3. 加权循环：为服务器分配不同的权重，反映其容量。

您还可以使用API Gateway等模式作为微服务架构中的负载均衡器，以在微服务的多个实例之间分配传入流量。

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/01.webp"/>

API 网关充当客户端访问各种微服务的单一入口点，提供负载平衡、路由、安全性等优势。我在之前的文章中也深入讨论了API Gateway 的工作原理，您也可以看到

<hr />

### 3. 自动扩展：适应需求

这是您可以用来将微服务扩展到数百万个的另一种策略。自动缩放允许微服务根据流量波动动态调整其资源。

自动扩展系统无需手动配置和取消配置实例，而是持续监控负载并根据需要添加或删除实例。

这确保了最佳性能和成本效率。

触发自动缩放的关键指标包括CPU利用率、内存消耗和响应时间。AWS、Google Cloud和Azure等所有主要云平台都提供可与微服务部署集成的自动扩展服务。

以下是在 AWS 云中设置 Auto Scaling 的示例：

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/02.webp"/>

<hr />

### 4. 性能优化：保证高效执行

这可能是扩展应用程序并保持其响应能力的最古老的策略。性能优化涉及微调微服务以最大限度地提高效率并最大限度地缩短响应时间。技术包括：

1. 缓存：将经常访问的数据存储在内存中，以减少数据库查询。
2. 异步处理：将资源密集型任务移至后台工作人员或队列。
3. 数据库分片：将数据分布到多个数据库实例以提高读写性能。

这是AWS无服务器架构中缓存的另一个很好的例子

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/03.webp"/>

<hr />

### 5. 现实世界的例子：Uber 的可扩展性之旅

没有比看例子更好的方法来理解任何事情了。让我们看一个现实世界的例子来说明这些扩展策略的实际应用：叫车巨头 Uber。

Uber 的微服务架构使其能够在全球众多城市无缝运营，每天为数百万用户提供服务。随着 Uber 的受欢迎程度飙升，有效扩展其服务变得至关重要。

顺便说一句，这是我做的另一件事，建议其他开发人员阅读 Uber、NetFlix 等科技巨头的工程博客，了解他们如何解决挑战。这将提高您的知识和理解力。

Uber 的微服务架构如下所示：

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/04.webp"/>

您可以看到他们正在使用API 网关、缓存代理以及更多您可以学习的东西，以将您的微服务扩展到数百万个。

### 6. Uber 中的负载均衡

为了管理高流量，Uber 采用了强大的负载平衡机制。当用户打开 Uber 应用程序时，他们的请求将被定向到附近的数据中心。

在数据中心内，负载均衡器使用最少连接算法将请求分发到最不繁忙的微服务实例。

这确保了用户请求的均匀分布，防止任何单个微服务实例变得不堪重负。您可以在此处阅读有关 Uber 实时负载平衡的更多信息。

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/05.webp"/>

<hr />

### 7. 自动扩展以满足需求

在高峰时段或特殊活动期间，优步的乘车请求会激增。为了应对这些高峰，Uber 广泛利用了自动扩展功能。

例如，负责匹配乘客和司机的“乘车请求”微服务会根据传入请求数量和平均响应时间等指标动态扩展其实例。

Uber 的自动扩展系统会监控这些指标并自动调整实例数量，以确保较短的响应时间和快速的乘车匹配。当流量减少时，不必要的实例就会减少，从而优化资源使用和成本。

<img src="https://cdn.jsdelivr.net/gh/dongzl/dongzl.github.io@hexo/source/images/2023/24-Scaling-Microservices-Strategies-Handling-Increased-Demand-Efficiency/06.webp"/>

<hr />

### 8. 性能优化，打造无缝体验
   
Uber 的应用程序提供实时位置跟踪，这需要高性能的微服务。为了优化性能，Uber 广泛使用缓存。

驾驶员和乘客数据以及乘车状态更新都缓存在内存中，从而减少了频繁的数据库查询的需要。

此外，Uber 采用异步处理来执行计算乘车费用和发送通知等任务。

通过将这些任务转移到后台工作人员和队列，微服务可以快速处理乘车数据，而不会影响用户体验。

### 结论

这就是将微服务扩展到数百万用户所需要做的所有重要事情。虽然这看起来很简单，但当你真正去做时，你会意识到它需要仔细的计划和执行。

随着用户需求不断增加，有效扩展微服务是现代应用程序开发的一个关键方面。负载均衡、自动扩展和性能优化是确保基于微服务的应用程序实现最佳性能、可靠性和成本效益的基本策略。

Uber 等现实世界的例子展示了这些策略的实际实施，展示了它们在处理高流量和需求方面的有效性。

通过利用负载平衡算法、自动扩展机制和性能优化技术，您可以创建弹性且响应迅速的微服务生态系统，即使在高峰使用期间也能提供无缝的用户体验。

总之，面对不断增长的用户期望和流量，掌握扩展微服务的艺术对于旨在提供高质量数字服务的企业至关重要。

顺便说一句，如果你正在准备微服务面试，那么你还应该准备一些问题，比如API网关和负载均衡器之间的区别、SAGA模式、如何管理微服务中的事务、SAGA和CQRS模式之间的区别，这些问题在面试中很受欢迎。
